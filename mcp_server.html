<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Python: module mcp_server</title>
</head><body>

<table class="heading">
<tr class="heading-text decor">
<td class="title">&nbsp;<br><strong class="title">mcp_server</strong></td>
<td class="extra"><a href=".">index</a><br><a href="file:/home/runner/work/comfy-gen/comfy-gen/mcp_server.py">/home/runner/work/comfy-gen/comfy-gen/mcp_server.py</a></td></tr></table>
    <p><span class="code">MCP&nbsp;server&nbsp;for&nbsp;ComfyGen&nbsp;-&nbsp;AI&nbsp;assistant&nbsp;integration.<br>
&nbsp;<br>
This&nbsp;server&nbsp;exposes&nbsp;ComfyUI&nbsp;image/video&nbsp;generation&nbsp;capabilities&nbsp;via&nbsp;the&nbsp;Model&nbsp;Context&nbsp;Protocol,<br>
allowing&nbsp;AI&nbsp;assistants&nbsp;to&nbsp;generate&nbsp;images&nbsp;through&nbsp;tool&nbsp;calls.<br>
&nbsp;<br>
Usage:<br>
&nbsp;&nbsp;&nbsp;&nbsp;python3&nbsp;mcp_server.py<br>
&nbsp;<br>
VS&nbsp;Code&nbsp;MCP&nbsp;Configuration:<br>
&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"mcpServers":&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"comfy-gen":&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"command":&nbsp;"python3",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"args":&nbsp;["/path/to/comfy-gen/mcp_server.py"],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"env":&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"COMFYUI_HOST":&nbsp;"<a href="http://192.168.1.215:8188">http://192.168.1.215:8188</a>",<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"MINIO_ENDPOINT":&nbsp;"192.168.1.215:9000"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p>
<table class="section">
<tr class="decor pkg-content-decor heading-text">
<td class="section-title" colspan=3>&nbsp;<br><strong class="bigsection">Modules</strong></td></tr>
    
<tr><td class="decor pkg-content-decor"><span class="code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td><td>&nbsp;</td>
<td class="singlecolumn"><table><tr><td class="multicolumn"><a href="asyncio.html">asyncio</a><br>
<a href="json.html">json</a><br>
</td><td class="multicolumn"><a href="os.html">os</a><br>
<a href="requests.html">requests</a><br>
</td><td class="multicolumn"><a href="sys.html">sys</a><br>
</td><td class="multicolumn"></td></tr></table></td></tr></table><p>
<table class="section">
<tr class="decor functions-decor heading-text">
<td class="section-title" colspan=3>&nbsp;<br><strong class="bigsection">Functions</strong></td></tr>
    
<tr><td class="decor functions-decor"><span class="code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td><td>&nbsp;</td>
<td class="singlecolumn"><dl><dt><a name="-add_loras_to_workflow"><strong>add_loras_to_workflow</strong></a>(workflow: Dict, loras: List[Dict]) -&gt; Dict</dt><dd><span class="code">Add&nbsp;LoRA&nbsp;loaders&nbsp;to&nbsp;the&nbsp;workflow.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;workflow:&nbsp;Base&nbsp;workflow&nbsp;JSON<br>
&nbsp;&nbsp;&nbsp;&nbsp;loras:&nbsp;List&nbsp;of&nbsp;dicts&nbsp;with&nbsp;'name'&nbsp;and&nbsp;'strength'&nbsp;keys<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Modified&nbsp;workflow&nbsp;with&nbsp;LoRA&nbsp;loaders</span></dd></dl>
 <dl><dt>async <a name="-cancel_generation"><strong>cancel_generation</strong></a>() -&gt; Dict[str, Any]</dt><dd><span class="code">Cancel&nbsp;the&nbsp;current&nbsp;generation&nbsp;job.<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;cancellation&nbsp;status</span></dd></dl>
 <dl><dt><a name="-download_output"><strong>download_output</strong></a>(status: Dict, output_path: str) -&gt; bool</dt><dd><span class="code">Download&nbsp;the&nbsp;generated&nbsp;image&nbsp;from&nbsp;ComfyUI.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;status:&nbsp;History&nbsp;status&nbsp;dict&nbsp;from&nbsp;ComfyUI<br>
&nbsp;&nbsp;&nbsp;&nbsp;output_path:&nbsp;Local&nbsp;path&nbsp;to&nbsp;save&nbsp;the&nbsp;image<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;True&nbsp;if&nbsp;successful,&nbsp;False&nbsp;otherwise</span></dd></dl>
 <dl><dt>async <a name="-generate_image"><strong>generate_image</strong></a>(prompt: str, negative_prompt: str = 'blurry, low quality, bad anatomy, watermark', model: str = 'sd15', loras: Optional[List[Dict[str, Any]]] = None, width: int = 512, height: int = 512, steps: int = 20, cfg: float = 7.0, seed: int = -1) -&gt; Dict[str, Any]</dt><dd><span class="code">Generate&nbsp;an&nbsp;image&nbsp;using&nbsp;ComfyUI.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;prompt:&nbsp;Text&nbsp;description&nbsp;of&nbsp;the&nbsp;image&nbsp;to&nbsp;generate<br>
&nbsp;&nbsp;&nbsp;&nbsp;negative_prompt:&nbsp;Things&nbsp;to&nbsp;avoid&nbsp;in&nbsp;the&nbsp;image<br>
&nbsp;&nbsp;&nbsp;&nbsp;model:&nbsp;Model&nbsp;to&nbsp;use&nbsp;(sd15,&nbsp;flux)<br>
&nbsp;&nbsp;&nbsp;&nbsp;loras:&nbsp;List&nbsp;of&nbsp;LoRAs&nbsp;with&nbsp;format&nbsp;[{"name":&nbsp;"lora.safetensors",&nbsp;"strength":&nbsp;0.8}]<br>
&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;Image&nbsp;width&nbsp;in&nbsp;pixels<br>
&nbsp;&nbsp;&nbsp;&nbsp;height:&nbsp;Image&nbsp;height&nbsp;in&nbsp;pixels<br>
&nbsp;&nbsp;&nbsp;&nbsp;steps:&nbsp;Number&nbsp;of&nbsp;sampling&nbsp;steps<br>
&nbsp;&nbsp;&nbsp;&nbsp;cfg:&nbsp;CFG&nbsp;scale&nbsp;(guidance&nbsp;strength)<br>
&nbsp;&nbsp;&nbsp;&nbsp;seed:&nbsp;Random&nbsp;seed&nbsp;(-1&nbsp;for&nbsp;random)<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;status,&nbsp;prompt_id,&nbsp;and&nbsp;image_url&nbsp;when&nbsp;complete</span></dd></dl>
 <dl><dt>async <a name="-generate_video"><strong>generate_video</strong></a>(prompt: str, negative_prompt: str = 'blurry, low quality, distorted', width: int = 512, height: int = 512, frames: int = 16, steps: int = 20, cfg: float = 7.0, seed: int = -1) -&gt; Dict[str, Any]</dt><dd><span class="code">Generate&nbsp;a&nbsp;video&nbsp;using&nbsp;Wan&nbsp;2.2&nbsp;model.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;prompt:&nbsp;Text&nbsp;description&nbsp;of&nbsp;the&nbsp;video&nbsp;to&nbsp;generate<br>
&nbsp;&nbsp;&nbsp;&nbsp;negative_prompt:&nbsp;Things&nbsp;to&nbsp;avoid&nbsp;in&nbsp;the&nbsp;video<br>
&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;Video&nbsp;width&nbsp;in&nbsp;pixels<br>
&nbsp;&nbsp;&nbsp;&nbsp;height:&nbsp;Video&nbsp;height&nbsp;in&nbsp;pixels<br>
&nbsp;&nbsp;&nbsp;&nbsp;frames:&nbsp;Number&nbsp;of&nbsp;frames&nbsp;to&nbsp;generate<br>
&nbsp;&nbsp;&nbsp;&nbsp;steps:&nbsp;Number&nbsp;of&nbsp;sampling&nbsp;steps<br>
&nbsp;&nbsp;&nbsp;&nbsp;cfg:&nbsp;CFG&nbsp;scale&nbsp;(guidance&nbsp;strength)<br>
&nbsp;&nbsp;&nbsp;&nbsp;seed:&nbsp;Random&nbsp;seed&nbsp;(-1&nbsp;for&nbsp;random)<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;status,&nbsp;prompt_id,&nbsp;and&nbsp;video_url&nbsp;when&nbsp;complete</span></dd></dl>
 <dl><dt>async <a name="-get_image_url"><strong>get_image_url</strong></a>(filename: str) -&gt; Dict[str, Any]</dt><dd><span class="code">Get&nbsp;the&nbsp;URL&nbsp;for&nbsp;a&nbsp;specific&nbsp;image&nbsp;in&nbsp;MinIO.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;filename:&nbsp;Name&nbsp;of&nbsp;the&nbsp;image&nbsp;file<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;image&nbsp;URL&nbsp;and&nbsp;metadata</span></dd></dl>
 <dl><dt><a name="-get_minio_client"><strong>get_minio_client</strong></a>() -&gt; minio.api.Minio</dt><dd><span class="code">Get&nbsp;MinIO&nbsp;client&nbsp;instance.</span></dd></dl>
 <dl><dt>async <a name="-get_progress"><strong>get_progress</strong></a>() -&gt; Dict[str, Any]</dt><dd><span class="code">Check&nbsp;the&nbsp;progress&nbsp;of&nbsp;the&nbsp;current&nbsp;generation&nbsp;job.<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;current&nbsp;progress&nbsp;information</span></dd></dl>
 <dl><dt>async <a name="-list_images"><strong>list_images</strong></a>(limit: int = 50) -&gt; Dict[str, Any]</dt><dd><span class="code">List&nbsp;generated&nbsp;images&nbsp;in&nbsp;MinIO&nbsp;bucket.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;limit:&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;images&nbsp;to&nbsp;return<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;list&nbsp;of&nbsp;image&nbsp;URLs&nbsp;and&nbsp;metadata</span></dd></dl>
 <dl><dt>async <a name="-list_loras"><strong>list_loras</strong></a>() -&gt; Dict[str, Any]</dt><dd><span class="code">List&nbsp;available&nbsp;LoRA&nbsp;files&nbsp;from&nbsp;ComfyUI.<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;'loras'&nbsp;list&nbsp;and&nbsp;status</span></dd></dl>
 <dl><dt>async <a name="-list_models"><strong>list_models</strong></a>() -&gt; Dict[str, List[str]]</dt><dd><span class="code">List&nbsp;available&nbsp;checkpoint&nbsp;models&nbsp;from&nbsp;ComfyUI.<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Dict&nbsp;with&nbsp;'checkpoints'&nbsp;list&nbsp;and&nbsp;status</span></dd></dl>
 <dl><dt><a name="-load_workflow_template"><strong>load_workflow_template</strong></a>(workflow_type: str) -&gt; Dict</dt><dd><span class="code">Load&nbsp;workflow&nbsp;template&nbsp;from&nbsp;workflows&nbsp;directory.</span></dd></dl>
 <dl><dt><a name="-modify_workflow_parameters"><strong>modify_workflow_parameters</strong></a>(workflow: Dict, width: Optional[int] = None, height: Optional[int] = None, steps: Optional[int] = None, cfg: Optional[float] = None, seed: Optional[int] = None) -&gt; Dict</dt><dd><span class="code">Modify&nbsp;sampling&nbsp;parameters&nbsp;in&nbsp;the&nbsp;workflow.</span></dd></dl>
 <dl><dt><a name="-modify_workflow_prompt"><strong>modify_workflow_prompt</strong></a>(workflow: Dict, prompt: str, negative_prompt: str = '') -&gt; Dict</dt><dd><span class="code">Modify&nbsp;the&nbsp;prompt&nbsp;in&nbsp;the&nbsp;workflow&nbsp;JSON.</span></dd></dl>
 <dl><dt><a name="-upload_to_minio"><strong>upload_to_minio</strong></a>(file_path: str, object_name: str) -&gt; str</dt><dd><span class="code">Upload&nbsp;file&nbsp;to&nbsp;MinIO&nbsp;bucket.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;file_path:&nbsp;Local&nbsp;file&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;object_name:&nbsp;Object&nbsp;name&nbsp;in&nbsp;MinIO<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;Public&nbsp;URL&nbsp;of&nbsp;the&nbsp;uploaded&nbsp;file</span></dd></dl>
 <dl><dt>async <a name="-wait_for_completion"><strong>wait_for_completion</strong></a>(prompt_id: str, timeout: int = 300) -&gt; Optional[Dict]</dt><dd><span class="code">Wait&nbsp;for&nbsp;workflow&nbsp;to&nbsp;complete&nbsp;with&nbsp;async&nbsp;polling.<br>
&nbsp;<br>
Args:<br>
&nbsp;&nbsp;&nbsp;&nbsp;prompt_id:&nbsp;The&nbsp;prompt&nbsp;ID&nbsp;to&nbsp;wait&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;timeout:&nbsp;Maximum&nbsp;time&nbsp;to&nbsp;wait&nbsp;in&nbsp;seconds<br>
&nbsp;<br>
Returns:<br>
&nbsp;&nbsp;&nbsp;&nbsp;History&nbsp;status&nbsp;dict&nbsp;or&nbsp;None&nbsp;if&nbsp;failed</span></dd></dl>
</td></tr></table><p>
<table class="section">
<tr class="decor data-decor heading-text">
<td class="section-title" colspan=3>&nbsp;<br><strong class="bigsection">Data</strong></td></tr>
    
<tr><td class="decor data-decor"><span class="code">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td><td>&nbsp;</td>
<td class="singlecolumn"><strong>BUCKET_NAME</strong> = 'comfy-gen'<br>
<strong>COMFYUI_HOST</strong> = 'http://192.168.1.215:8188'<br>
<strong>Dict</strong> = typing.Dict<br>
<strong>List</strong> = typing.List<br>
<strong>MINIO_ACCESS_KEY</strong> = 'minioadmin'<br>
<strong>MINIO_ENDPOINT</strong> = '192.168.1.215:9000'<br>
<strong>MINIO_SECRET_KEY</strong> = 'minioadmin'<br>
<strong>Optional</strong> = typing.Optional<br>
<strong>__annotations__</strong> = {'current_prompt_id': typing.Optional[str], 'current_workflow': typing.Optional[typing.Dict]}<br>
<strong>current_prompt_id</strong> = None<br>
<strong>current_workflow</strong> = None<br>
<strong>mcp</strong> = &lt;mcp.server.fastmcp.server.FastMCP object&gt;</td></tr></table>
</body></html>